  </main>

  <!-- Toast Notification Container (Phase 3) -->
  <div class="toast-container" id="toast-container"></div>

  <footer class="app-footer">
    <div class="container">
      <% if (typeof user !== 'undefined' && user) { %>
        <div class="footer-players" id="active-players"></div>
      <% } %>
      <div class="footer-about">
        <strong>Quest Planner</strong> v<%= appVersion %> &mdash; Open-source D&D session scheduler
      </div>
      <div class="footer-links">
        <a href="https://github.com/nenadjokic/dndplanning" target="_blank">GitHub</a>
        <span class="footer-sep">&middot;</span>
        <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank">GPL-3.0 License</a>
        <span class="footer-sep">&middot;</span>
        <a href="https://buymeacoffee.com/nenadjokic" target="_blank">Buy Me a Coffee</a>
        <span class="footer-sep">&middot;</span>
        <a href="https://paypal.me/nenadjokicRS" target="_blank">PayPal</a>
      </div>
      <div class="footer-copy">
        Made with &hearts; by Nenad Jokic
      </div>
    </div>
  </footer>

  <% if (typeof showWhatsNew !== 'undefined' && showWhatsNew) { %>
    <div class="welcome-overlay" id="whatsnew-overlay">
      <div class="welcome-modal whatsnew-modal">
        <h2>What's New in v<%= appVersion %> ğŸ—ºï¸</h2>
        <div class="whatsnew-content">
          <h3 style="color: var(--gold); font-size: 0.95rem; margin-bottom: 0.5rem;">Bug Fixes <span style="color:var(--text-secondary);font-size:0.8rem;">(v2.0.10)</span></h3>
          <ul class="whatsnew-list">
            <li><strong>ğŸ¨ Max HP Themed</strong> &mdash; Max HP field in NPC Library now matches the dark theme</li>
            <li><strong>ğŸ–¼ï¸ SRD Avatar Fetch</strong> &mdash; "Fetch avatar from D&amp;D 5e SRD" button for Bestiary NPCs (actual monster images)</li>
          </ul>
          <h3 style="color: var(--gold); font-size: 0.95rem; margin-bottom: 0.5rem; margin-top: 1rem;">NPC Sidebar & Alignment <span style="color:var(--text-secondary);font-size:0.8rem;">(v2.0.9)</span></h3>
          <ul class="whatsnew-list">
            <li><strong>ğŸ“‹ NPC Sidebar</strong> &mdash; Persistent sidebar with categories, search, and click-to-place NPCs on the map</li>
            <li><strong>âš”ï¸ Alignment System</strong> &mdash; Per-NPC hostile/friendly/neutral with colored borders (red/green/white)</li>
            <li><strong>â˜‘ï¸ Multi-Category NPCs</strong> &mdash; NPCs can belong to multiple categories via checkboxes</li>
            <li><strong>ğŸ–¼ï¸ Open5e Avatars</strong> &mdash; Auto-fetch monster images from Open5e when creating NPCs from Bestiary</li>
          </ul>
          <h3 style="color: var(--gold); font-size: 0.95rem; margin-bottom: 0.5rem; margin-top: 1rem;">Map Links & Tokens</h3>
          <ul class="whatsnew-list">
            <li><strong>ğŸ”— Map Hyperlinks</strong> &mdash; Link any map to any other without parent-child restrictions</li>
            <li><strong>â•â– Global Scale Offset</strong> &mdash; +/- buttons to scale all tokens (player + NPC) relatively</li>
            <li><strong>âœ… Multi-Select</strong> &mdash; Ctrl+Click tokens to select and move as a group (DM only)</li>
            <li><strong>ğŸ¯ Fog Brush Cursor</strong> &mdash; Visual circle cursor showing brush size and reveal/hide mode</li>
          </ul>
          <h3 style="color: var(--gold); font-size: 0.95rem; margin-bottom: 0.5rem; margin-top: 1rem;">NPC Tokens & Fog of War <span style="color:var(--text-secondary);font-size:0.8rem;">(v2.0.8)</span></h3>
          <ul class="whatsnew-list">
            <li><strong>ğŸ‘¹ NPC Library</strong> &mdash; Create NPCs with categories, HP, avatars, and Bestiary import (2200+ monsters)</li>
            <li><strong>ğŸŒ«ï¸ Fog of War</strong> &mdash; Full-map fog with reveal/hide brush, draft &amp; publish workflow</li>
            <li><strong>ğŸ“¡ Real-Time Sync</strong> &mdash; Token moves, NPC changes, HP updates sync instantly via SSE</li>
            <li><strong>ğŸ–¥ï¸ Fullscreen Toolbar</strong> &mdash; All map controls available in fullscreen mode</li>
          </ul>
        </div>
        <div class="whatsnew-links">
          <a href="https://github.com/nenadjokic/dndplanning/releases" target="_blank" rel="noopener noreferrer" class="btn btn-outline btn-small">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
            Full Changelog
          </a>
        </div>
        <p style="margin-top: 1rem; margin-bottom: 0.5rem; color: var(--text-secondary);">Enjoy Quest Planner? Support the project:</p>
        <div class="whatsnew-support">
          <a href="https://buymeacoffee.com/nenadjokic" target="_blank" rel="noopener noreferrer">
            <img src="https://img.shields.io/badge/Buy%20Me%20a%20Coffee-ffdd00?style=for-the-badge&logo=buy-me-a-coffee&logoColor=black" alt="Buy Me a Coffee">
          </a>
          <a href="https://paypal.me/nenadjokicRS" target="_blank" rel="noopener noreferrer">
            <img src="https://img.shields.io/badge/PayPal-00457C?style=for-the-badge&logo=paypal&logoColor=white" alt="PayPal">
          </a>
        </div>
        <button class="btn btn-outline" id="whatsnew-close" style="margin-top: 1rem;">Continue to Quest Planner</button>
      </div>
    </div>
    <script>
      document.getElementById('whatsnew-close').addEventListener('click', function() {
        document.getElementById('whatsnew-overlay').remove();
      });
      document.getElementById('whatsnew-overlay').addEventListener('click', function(e) {
        if (e.target === this) this.remove();
      });
    </script>
  <% } %>

  <% if (typeof firstLogin !== 'undefined' && firstLogin) { %>
    <div class="welcome-overlay" id="welcome-overlay">
      <div class="welcome-modal">
        <h2>Welcome to Quest Planner!</h2>
        <p>Thank you for using this software! Quest Planner is free and open-source, licensed under the GPL-3.0.</p>
        <p>If you enjoy it and would like to support development, consider buying me a coffee:</p>
        <div class="welcome-links">
          <a href="https://buymeacoffee.com/nenadjokic" target="_blank" class="btn btn-primary btn-small">Buy Me a Coffee</a>
          <a href="https://paypal.me/nenadjokicRS" target="_blank" class="btn btn-outline btn-small">PayPal</a>
        </div>
        <p class="form-hint">You can always find these links in the footer.</p>
        <div style="text-align: center; margin: 1rem 0;">
          <img src="/icons/icon-192.png" alt="Quest Planner" style="width: 80px; height: 80px; border-radius: 12px;">
        </div>
        <button class="btn btn-outline" id="welcome-close">Enter the Tavern</button>
      </div>
    </div>
    <script>
      document.getElementById('welcome-close').addEventListener('click', function() {
        document.getElementById('welcome-overlay').remove();
      });
      document.getElementById('welcome-overlay').addEventListener('click', function(e) {
        if (e.target === this) this.remove();
      });
    </script>
  <% } %>

  <script src="/js/toast.js?v=<%= appVersion %>"></script>
  <script src="/js/datetime-picker.js?v=<%= appVersion %>"></script>
  <script src="/js/menu.js?v=<%= appVersion %>"></script>
  <script src="/js/app.js?v=<%= appVersion %>"></script>
  <script src="/js/dnd-modals.js?v=<%= appVersion %>"></script>
  <% if (typeof user !== 'undefined' && user) { %>
    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
    <link rel="stylesheet" href="/css/dice-roller.css?v=<%= appVersion %>">
    <script src="/js/dice-geometry.js?v=<%= appVersion %>"></script>
    <script src="/js/dice-themes.js?v=<%= appVersion %>"></script>
    <script type="module" src="/js/dice-roller.js?v=<%= appVersion %>"></script>
  <% } %>
</body>
</html>

<%- include('partials/head', { pageTitle: profileUser.username + '\'s Profile' }) %>

<div class="page-header">
  <h1><%= profileUser.username %>'s Profile</h1>
  <a href="/players" class="btn btn-outline">All Players</a>
</div>

<div class="card profile-card">
  <div class="profile-card-header">
    <% if (profileUser.avatar) { %>
      <img src="/avatars/<%= profileUser.avatar %>" alt="<%= profileUser.username %>" class="profile-avatar-lg">
    <% } else { %>
      <div class="profile-avatar-lg-placeholder"><%= profileUser.username.charAt(0).toUpperCase() %></div>
    <% } %>
    <div class="profile-card-info">
      <h2 style="margin-top: 0; margin-bottom: 0.25rem;"><%= profileUser.username %></h2>
      <span class="role-badge role-<%= profileUser.role %>"><%= profileUser.role === 'admin' ? 'Guild Master' : profileUser.role === 'dm' ? 'Dungeon Master' : 'Adventurer' %></span>
      <% if (profileUser.birthday) { %>
        <%
          const bParts = profileUser.birthday.split('-');
          const bDate = new Date(bParts[0], bParts[1] - 1, bParts[2]);
          const bFormatted = bDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
        %>
        <div class="profile-birthday" style="margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">Birthday: <%= bFormatted %></div>
      <% } %>
    </div>
  </div>

  <% if (profileUser.about) { %>
    <div class="profile-section">
      <h3>About</h3>
      <div class="recap-rendered"><%- renderMarkdown(profileUser.about) %></div>
    </div>
  <% } %>

  <%
    let socials = {};
    try {
      socials = profileUser.socials ? JSON.parse(profileUser.socials) : {};
    } catch (e) {
      socials = {};
    }
  %>
  <% if (Object.keys(socials).length > 0) { %>
    <div class="profile-section">
      <h3>Social Links</h3>
      <div class="profile-socials">
        <% if (socials.discord) { %>
          <div class="profile-social-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #5865F2;">
              <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
            </svg>
            <span><%= socials.discord %></span>
          </div>
        <% } %>
        <% if (socials.steam) { %>
          <div class="profile-social-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #171a21;">
              <path d="M11.979 0C5.678 0 .511 4.86.022 11.037l6.432 2.658c.545-.371 1.203-.59 1.912-.59.063 0 .125.004.188.006l2.861-4.142V8.91c0-2.495 2.028-4.524 4.524-4.524 2.494 0 4.524 2.031 4.524 4.527s-2.03 4.525-4.524 4.525h-.105l-4.076 2.911c0 .052.004.105.004.159 0 1.875-1.515 3.396-3.39 3.396-1.635 0-3.016-1.173-3.331-2.727L.436 15.27C1.862 20.307 6.486 24 11.979 24c6.627 0 11.999-5.373 11.999-12S18.605 0 11.979 0zM7.54 18.21l-1.473-.61c.262.543.714.999 1.314 1.25 1.297.539 2.793-.076 3.332-1.375.263-.63.264-1.319.005-1.949s-.75-1.121-1.377-1.383c-.624-.26-1.29-.249-1.878-.03l1.523.63c.956.4 1.409 1.5 1.009 2.455-.397.957-1.497 1.41-2.454 1.012H7.54zm11.415-9.303c0-1.662-1.353-3.015-3.015-3.015-1.665 0-3.015 1.353-3.015 3.015 0 1.665 1.35 3.015 3.015 3.015 1.663 0 3.015-1.35 3.015-3.015zm-5.273-.005c0-1.252 1.013-2.266 2.265-2.266 1.249 0 2.266 1.014 2.266 2.266 0 1.251-1.017 2.265-2.266 2.265-1.253 0-2.265-1.014-2.265-2.265z"/>
            </svg>
            <a href="<%= socials.steam %>" target="_blank" rel="noopener noreferrer" class="profile-social-link">Steam Profile</a>
          </div>
        <% } %>
        <% if (socials.twitter) { %>
          <div class="profile-social-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #1DA1F2;">
              <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
            </svg>
            <span><%= socials.twitter %></span>
          </div>
        <% } %>
        <% if (socials.twitch) { %>
          <div class="profile-social-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #9146FF;">
              <path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714Z"/>
            </svg>
            <a href="https://twitch.tv/<%= socials.twitch %>" target="_blank" rel="noopener noreferrer" class="profile-social-link"><%= socials.twitch %></a>
          </div>
        <% } %>
        <% if (socials.youtube) { %>
          <div class="profile-social-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #FF0000;">
              <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
            </svg>
            <a href="<%= socials.youtube %>" target="_blank" rel="noopener noreferrer" class="profile-social-link">YouTube Channel</a>
          </div>
        <% } %>
        <% if (socials.instagram) { %>
          <div class="profile-social-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #E4405F;">
              <path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678a6.162 6.162 0 1 0 0 12.324 6.162 6.162 0 1 0 0-12.324zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405a1.441 1.441 0 1 1-2.882 0 1.441 1.441 0 0 1 2.882 0z"/>
            </svg>
            <a href="https://instagram.com/<%= socials.instagram.replace('@','') %>" target="_blank" rel="noopener noreferrer" class="profile-social-link"><%= socials.instagram %></a>
          </div>
        <% } %>
        <% if (socials.reddit) { %>
          <div class="profile-social-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #FF4500;">
              <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
            </svg>
            <a href="https://reddit.com/user/<%= socials.reddit.replace('u/','') %>" target="_blank" rel="noopener noreferrer" class="profile-social-link"><%= socials.reddit %></a>
          </div>
        <% } %>
        <% if (socials.tiktok) { %>
          <div class="profile-social-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #00f2ea;">
              <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/>
            </svg>
            <a href="https://tiktok.com/<%= socials.tiktok.replace('@','') %>" target="_blank" rel="noopener noreferrer" class="profile-social-link"><%= socials.tiktok %></a>
          </div>
        <% } %>
        <% if (socials.dndbeyond) { %>
          <div class="profile-social-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #CC3333;">
              <path d="M2.214 12.006c0 2.007.676 3.726 1.678 5.164-.472-.674-.755-1.615-.755-2.67 0-2.89 2.068-5.324 3.556-7.088.468-.555.898-1.064 1.227-1.532.533-.761.879-1.478.879-2.387 0-.462-.09-.888-.248-1.266.986 1.126 1.627 2.916 1.627 4.416 0 1.876-1.195 3.184-2.318 4.417-1.034 1.135-2.004 2.2-2.004 3.581 0 1.752 1.127 3.29 2.8 3.834-.58-.482-.957-1.2-.957-2.024 0-1.4 1.027-2.498 2.073-3.613.88-.939 1.788-1.91 2.221-3.15.186.497.294 1.048.294 1.646 0 1.876-1.196 3.184-2.318 4.417-1.035 1.134-2.004 2.2-2.004 3.58 0 .536.096 1.046.264 1.517C5.494 18.846 3.71 15.686 3.71 12.006c0-3.233 1.284-6.186 3.373-8.348-.818 1.204-1.285 2.65-1.285 4.2 0 1.297.286 2.49.797 3.559.34-.94.792-1.836 1.354-2.659C9.696 6.226 12 3.575 12 .006c0-.003 0-.003 0-.006 0 .003 0 .003 0 .006 0 3.569 2.304 6.22 4.051 8.746.562.823 1.015 1.72 1.354 2.659.511-1.069.797-2.262.797-3.559 0-1.55-.467-2.996-1.285-4.2 2.089 2.162 3.373 5.115 3.373 8.348 0 3.68-1.784 6.84-4.547 8.772.168-.471.264-.98.264-1.517 0-1.381-.97-2.447-2.004-3.581-1.122-1.233-2.318-2.541-2.318-4.417 0-.598.108-1.15.294-1.645.433 1.239 1.34 2.21 2.221 3.149 1.046 1.115 2.073 2.213 2.073 3.613 0 .824-.377 1.542-.957 2.024 1.673-.544 2.8-2.082 2.8-3.834 0-1.382-.97-2.447-2.004-3.581-1.123-1.233-2.318-2.541-2.318-4.417 0-1.5.641-3.29 1.627-4.416a3.44 3.44 0 0 0-.248 1.266c0 .909.346 1.626.879 2.387.33.468.759.977 1.227 1.532 1.488 1.764 3.556 4.198 3.556 7.088 0 1.055-.283 1.996-.755 2.67 1.002-1.438 1.678-3.157 1.678-5.164C21.786 5.824 17.413 1.023 12 .478 6.587 1.023 2.214 5.824 2.214 12.006Z"/>
            </svg>
            <a href="<%= socials.dndbeyond %>" target="_blank" rel="noopener noreferrer" class="profile-social-link">D&D Beyond</a>
          </div>
        <% } %>
      </div>
    </div>
  <% } %>
</div>

<% if (characters.length > 0) { %>
  <div class="settings-section card">
    <h2>Characters</h2>
    <div class="characters-grid">
      <% for (const char of characters) { %>
        <a href="/profile/<%= encodeURIComponent(profileUser.username) %>/character/<%= char.id %>" class="character-card-link">
          <div class="character-card character-card-public">
            <div class="character-card-avatar">
              <% if (char.avatar) { %>
                <img src="/avatars/<%= char.avatar %>" alt="<%= char.name %>" class="character-card-img">
              <% } else { %>
                <div class="character-card-placeholder"><%= char.name.charAt(0).toUpperCase() %></div>
              <% } %>
            </div>
            <div class="character-card-name"><%= char.name %></div>
            <% if (char.class || char.race) { %>
              <div class="character-card-meta">
                <% if (char.race) { %><%= char.race %><% } %>
                <% if (char.race && char.class) { %> <% } %>
                <% if (char.class) { %><span data-class="<%= char.class %>"><%= char.class %></span><% } %>
              </div>
            <% } %>
            <% if (char.sheet_data) { %>
              <div class="character-card-meta" style="color: var(--gold); font-style: normal; font-size: 0.7rem; margin-top: 0.25rem;">Character Sheet Available</div>
            <% } %>
          </div>
        </a>
      <% } %>
    </div>
  </div>
<% } %>

<% if (profileUser.character_info || profileUser.character_avatar) { %>
  <div class="settings-section card">
    <h2>Legacy Character</h2>
    <% if (profileUser.character_avatar) { %>
      <div style="margin-bottom: 1rem;">
        <img src="/avatars/<%= profileUser.character_avatar %>" alt="Character" class="character-avatar-preview">
      </div>
    <% } %>
    <% if (profileUser.character_info) { %>
      <div class="recap-rendered"><%- renderMarkdown(profileUser.character_info) %></div>
    <% } %>
  </div>
<% } %>

<%- include('partials/foot') %>

<%- include('partials/head', { pageTitle: profileUser.username + '\'s Profile' }) %>

<div class="page-header">
  <h1><%= profileUser.username %>'s Profile</h1>
  <a href="/players" class="btn btn-outline">All Players</a>
</div>

<div class="card profile-card">
  <div class="profile-card-header">
    <% if (profileUser.avatar) { %>
      <img src="/avatars/<%= profileUser.avatar %>" alt="<%= profileUser.username %>" class="profile-avatar-lg">
    <% } else { %>
      <div class="profile-avatar-lg-placeholder"><%= profileUser.username.charAt(0).toUpperCase() %></div>
    <% } %>
    <div class="profile-card-info">
      <h2 style="margin-top: 0; margin-bottom: 0.25rem;"><%= profileUser.username %></h2>
      <span class="role-badge role-<%= profileUser.role %>"><%= profileUser.role === 'admin' ? 'Guild Master' : profileUser.role === 'dm' ? 'Dungeon Master' : 'Adventurer' %></span>
      <% if (profileUser.birthday) { %>
        <%
          const bParts = profileUser.birthday.split('-');
          const bDate = new Date(bParts[0], bParts[1] - 1, bParts[2]);
          const bFormatted = bDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
        %>
        <div class="profile-birthday" style="margin-top: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">Birthday: <%= bFormatted %></div>
      <% } %>
    </div>
  </div>

  <% if (profileUser.about) { %>
    <div class="profile-section">
      <h3>About</h3>
      <div class="recap-rendered"><%- renderMarkdown(profileUser.about) %></div>
    </div>
  <% } %>

  <%
    let socials = {};
    try {
      socials = profileUser.socials ? JSON.parse(profileUser.socials) : {};
    } catch (e) {
      socials = {};
    }
  %>
  <% if (Object.keys(socials).length > 0) { %>
    <div class="profile-section">
      <h3>Social Links</h3>
      <div class="profile-socials">
        <% if (socials.discord) { %>
          <div class="profile-social-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #5865F2;">
              <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
            </svg>
            <span><%= socials.discord %></span>
          </div>
        <% } %>
        <% if (socials.steam) { %>
          <div class="profile-social-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #171a21;">
              <path d="M11.979 0C5.678 0 .511 4.86.022 11.037l6.432 2.658c.545-.371 1.203-.59 1.912-.59.063 0 .125.004.188.006l2.861-4.142V8.91c0-2.495 2.028-4.524 4.524-4.524 2.494 0 4.524 2.031 4.524 4.527s-2.03 4.525-4.524 4.525h-.105l-4.076 2.911c0 .052.004.105.004.159 0 1.875-1.515 3.396-3.39 3.396-1.635 0-3.016-1.173-3.331-2.727L.436 15.27C1.862 20.307 6.486 24 11.979 24c6.627 0 11.999-5.373 11.999-12S18.605 0 11.979 0zM7.54 18.21l-1.473-.61c.262.543.714.999 1.314 1.25 1.297.539 2.793-.076 3.332-1.375.263-.63.264-1.319.005-1.949s-.75-1.121-1.377-1.383c-.624-.26-1.29-.249-1.878-.03l1.523.63c.956.4 1.409 1.5 1.009 2.455-.397.957-1.497 1.41-2.454 1.012H7.54zm11.415-9.303c0-1.662-1.353-3.015-3.015-3.015-1.665 0-3.015 1.353-3.015 3.015 0 1.665 1.35 3.015 3.015 3.015 1.663 0 3.015-1.35 3.015-3.015zm-5.273-.005c0-1.252 1.013-2.266 2.265-2.266 1.249 0 2.266 1.014 2.266 2.266 0 1.251-1.017 2.265-2.266 2.265-1.253 0-2.265-1.014-2.265-2.265z"/>
            </svg>
            <a href="<%= socials.steam %>" target="_blank" rel="noopener noreferrer" class="profile-social-link">Steam Profile</a>
          </div>
        <% } %>
        <% if (socials.twitter) { %>
          <div class="profile-social-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #1DA1F2;">
              <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
            </svg>
            <span><%= socials.twitter %></span>
          </div>
        <% } %>
        <% if (socials.twitch) { %>
          <div class="profile-social-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #9146FF;">
              <path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714Z"/>
            </svg>
            <a href="https://twitch.tv/<%= socials.twitch %>" target="_blank" rel="noopener noreferrer" class="profile-social-link"><%= socials.twitch %></a>
          </div>
        <% } %>
        <% if (socials.youtube) { %>
          <div class="profile-social-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #FF0000;">
              <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
            </svg>
            <a href="<%= socials.youtube %>" target="_blank" rel="noopener noreferrer" class="profile-social-link">YouTube Channel</a>
          </div>
        <% } %>
      </div>
    </div>
  <% } %>
</div>

<% if (characters.length > 0) { %>
  <div class="settings-section card">
    <h2>Characters</h2>
    <div class="characters-grid">
      <% for (const char of characters) { %>
        <a href="/profile/<%= encodeURIComponent(profileUser.username) %>/character/<%= char.id %>" class="character-card-link">
          <div class="character-card character-card-public">
            <div class="character-card-avatar">
              <% if (char.avatar) { %>
                <img src="/avatars/<%= char.avatar %>" alt="<%= char.name %>" class="character-card-img">
              <% } else { %>
                <div class="character-card-placeholder"><%= char.name.charAt(0).toUpperCase() %></div>
              <% } %>
            </div>
            <div class="character-card-name"><%= char.name %></div>
            <% if (char.class || char.race) { %>
              <div class="character-card-meta">
                <% if (char.race) { %><%= char.race %><% } %>
                <% if (char.race && char.class) { %> <% } %>
                <% if (char.class) { %><span data-class="<%= char.class %>"><%= char.class %></span><% } %>
              </div>
            <% } %>
            <% if (char.sheet_data) { %>
              <div class="character-card-meta" style="color: var(--gold); font-style: normal; font-size: 0.7rem; margin-top: 0.25rem;">Character Sheet Available</div>
            <% } %>
          </div>
        </a>
      <% } %>
    </div>
  </div>
<% } %>

<% if (profileUser.character_info || profileUser.character_avatar) { %>
  <div class="settings-section card">
    <h2>Legacy Character</h2>
    <% if (profileUser.character_avatar) { %>
      <div style="margin-bottom: 1rem;">
        <img src="/avatars/<%= profileUser.character_avatar %>" alt="Character" class="character-avatar-preview">
      </div>
    <% } %>
    <% if (profileUser.character_info) { %>
      <div class="recap-rendered"><%- renderMarkdown(profileUser.character_info) %></div>
    <% } %>
  </div>
<% } %>

<%- include('partials/foot') %>

<%- include('partials/head', { pageTitle: 'Maps' }) %>

<div class="page-header">
  <h1>Maps</h1>
  <div>
    <% if (isDM) { %>
      <button type="button" class="btn btn-outline btn-small" onclick="document.getElementById('create-map-form').style.display = document.getElementById('create-map-form').style.display === 'none' ? 'block' : 'none'">+ New Map</button>
    <% } %>
    <a href="/" class="btn btn-outline btn-small">Back to Chamber</a>
  </div>
</div>

<% if (isDM) { %>
  <div id="create-map-form" style="display:none; margin-bottom: 1rem;">
    <div class="card" style="border: 1px solid var(--gold-dim);">
      <h3>Create Map</h3>
      <form action="/map" method="POST">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <div class="form-group">
          <label for="map_name">Map Name</label>
          <input type="text" name="name" id="map_name" required placeholder="e.g. World Map, Dungeon Level 1, Town of Phandalin">
        </div>
        <div style="display: flex; gap: 0.5rem;">
          <button type="submit" class="btn btn-primary btn-small">Create</button>
          <button type="button" class="btn btn-outline btn-small" onclick="document.getElementById('create-map-form').style.display='none'">Cancel</button>
        </div>
      </form>
    </div>
  </div>
<% } %>

<% if (maps.length === 0) { %>
  <div class="card">
    <p class="empty-state-text">No maps yet.<% if (isDM) { %> Create one above to get started.<% } %></p>
  </div>
<% } else { %>
  <div class="card">
    <div class="admin-table-wrapper">
      <table class="admin-table">
        <thead>
          <tr>
            <th style="width: 60px;"></th>
            <th>Name</th>
            <th>Created</th>
            <% if (isDM) { %><th style="width: 60px;">Actions</th><% } %>
          </tr>
        </thead>
        <tbody>
          <% for (const m of maps) { %>
            <tr>
              <td>
                <% if (m.image_path) { %>
                  <a href="/map/<%= m.id %>"><img src="/maps/<%= m.image_path %>" alt="" style="width: 50px; height: 35px; object-fit: cover; border-radius: 4px; border: 1px solid var(--border);"></a>
                <% } else { %>
                  <a href="/map/<%= m.id %>">
                    <div style="width: 50px; height: 35px; background: var(--bg-input); border-radius: 4px; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center;">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--text-secondary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                    </div>
                  </a>
                <% } %>
              </td>
              <td><a href="/map/<%= m.id %>" style="color: var(--gold); font-weight: 600;"><%= m.name %></a></td>
              <td class="text-muted"><%= new Date(m.created_at).toLocaleDateString() %></td>
              <% if (isDM) { %>
                <td>
                  <form action="/map/<%= m.id %>/delete" method="POST" class="inline-form">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <button type="submit" class="btn btn-small btn-danger" onclick="return confirm('Delete this map and all its locations?')">&times;</button>
                  </form>
                </td>
              <% } %>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
<% } %>

<%- include('partials/foot') %>

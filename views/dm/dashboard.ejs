<%- include('../partials/head', { pageTitle: 'Dungeon Master\'s Chamber' }) %>

<div class="page-header">
  <h1>Dungeon Master's Chamber</h1>
  <a href="/sessions/new" class="btn btn-primary">Post to Tavern Board</a>
</div>

<% if (birthdayUsers && birthdayUsers.length > 0) { %>
  <div class="birthday-banner">
    <span class="birthday-icon">&#127874;</span> Happy Birthday <%= birthdayUsers.map(u => u.username).join(', ') %>!
  </div>
<% } %>

<% if (sessions.length === 0) { %>
  <div class="card">
    <%- include('../partials/empty-state', {
      icon: 'ðŸ“œ',
      title: 'No Quests Posted',
      description: 'Create your first session to summon the party and begin the adventure!',
      cta: '<a href="/sessions/new" class="btn btn-primary">Post Your First Quest</a>'
    }) %>
  </div>
<% } else { %>
  <div class="session-grid">
    <% for (const s of sessions) { %>
      <a href="/sessions/<%= s.id %>" class="card session-card session-<%= s.status %> session-cat-<%= s.category || 'dnd' %>">
        <div class="session-category"><%= s.category === 'gamenight' ? 'Game Night' : s.category === 'rpg' ? 'RPG' : s.category === 'casual' ? 'Casual' : 'D&D' %></div>
        <div class="session-status-badge"><%= s.status %></div>
        <h2><%= s.title %></h2>
        <% if (s.description) { %>
          <p class="session-desc"><%= s.description %></p>
        <% } %>
        <% if ((s.status === 'confirmed' || s.status === 'completed') && s.confirmed_date) { %>
          <div class="session-confirmed-date">
            <%= formatDate(s.confirmed_date, { weekday: 'long', month: 'long', day: 'numeric' }) %>
            <% if (s.confirmed_label) { %> &mdash; <%= s.confirmed_label %><% } %>
          </div>
        <% } %>
        <div class="session-meta"><%= (s.status === 'completed' || s.status === 'confirmed') && s.confirmed_date ? formatDate(s.confirmed_date, { showTime: false }) : 'Created ' + formatDate(s.created_at, { showTime: false }) %></div>
      </a>
    <% } %>
  </div>
<% } %>

<%- include('../partials/foot') %>
